
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Duck Typing, Interfaces, and Benchmarking &#8212; Julia for HPC&lt;br&gt;EuXFEL Workshop</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Code Specialization" href="3-specialization.html" />
    <link rel="prev" title="Introduction" href="1-types-dispatch.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Julia for HPC<br>EuXFEL Workshop</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    Jupyter for HPC - EuXFEL Trial Run
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Day 1 - Basics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0-syntax.html">
   Syntax
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-types-dispatch.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Duck Typing, Interfaces, and Benchmarking
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3-specialization.html">
   Code Specialization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-generic-programming.html">
   Generic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5-workflow.html">
   Development Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6-pkg-management.html">
   Package Management
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Day 2 - Serial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../2-serial/1-optimizing-serial-performance.html">
   Optimizing Serial Performance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-serial/2-simd.html">
   SIMD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-serial/3-interop-microbenchmark.html">
   Programming Language Interoperability (Interop)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-serial/4-linalg-pefrormance.html">
   Performance Considerations for Linear Algebra
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Day 3 - Parallel
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3-parallel/1-parallelism-concurrency.html">
   Parallel Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3-parallel/2-distributed-computing.html">
   Distributed Computing:
   <code class="docutils literal notranslate">
    <span class="pre">
     Distributed
    </span>
   </code>
   standard library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3-parallel/3-distributed-computing-mpi.html">
   Distributed Computing: Message Passing Interface (MPI)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3-parallel/4-multithreading.html">
   Multithreading
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/robertrosca/julia-hpc-workshop/master?urlpath=tree/sessions/1-basics/2-duck-typing-benchmarking.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/robertrosca/julia-hpc-workshop"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/robertrosca/julia-hpc-workshop/issues/new?title=Issue%20on%20page%20%2Fsessions/1-basics/2-duck-typing-benchmarking.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/sessions/1-basics/2-duck-typing-benchmarking.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Duck Typing, Interfaces, and Benchmarking
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-unitrange">
     Example 1:
     <code class="docutils literal notranslate">
      <span class="pre">
       UnitRange
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-diagonalmatrix">
     Example 2:
     <code class="docutils literal notranslate">
      <span class="pre">
       DiagonalMatrix
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#side-note-consistency-of-interfaces">
     Side Note: Consistency of Interfaces
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benchmarking-with-benchmarktools-jl">
     Benchmarking with
     <code class="docutils literal notranslate">
      <span class="pre">
       BenchmarkTools.jl
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#custom-types-are-just-as-good-as-built-in-types">
       Custom types are just as good as built-in types
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-cooler-diagonal-matrix">
     Example 3: Cooler Diagonal Matrix
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-messages-of-this-notebook">
   Core messages of this notebook
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Duck Typing, Interfaces, and Benchmarking</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Duck Typing, Interfaces, and Benchmarking
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-unitrange">
     Example 1:
     <code class="docutils literal notranslate">
      <span class="pre">
       UnitRange
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-diagonalmatrix">
     Example 2:
     <code class="docutils literal notranslate">
      <span class="pre">
       DiagonalMatrix
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#side-note-consistency-of-interfaces">
     Side Note: Consistency of Interfaces
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benchmarking-with-benchmarktools-jl">
     Benchmarking with
     <code class="docutils literal notranslate">
      <span class="pre">
       BenchmarkTools.jl
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#custom-types-are-just-as-good-as-built-in-types">
       Custom types are just as good as built-in types
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-cooler-diagonal-matrix">
     Example 3: Cooler Diagonal Matrix
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-messages-of-this-notebook">
   Core messages of this notebook
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="duck-typing-interfaces-and-benchmarking">
<h1>Duck Typing, Interfaces, and Benchmarking<a class="headerlink" href="#duck-typing-interfaces-and-benchmarking" title="Permalink to this headline">#</a></h1>
<p>Julia’s ‘interfaces’ and duck-typing are a core part of Julia’s type system.</p>
<blockquote>
<div><p>A lot of the power and extensibility in Julia comes from a collection of informal interfaces. By extending a few specific methods to work for a custom type, objects of that type not only receive those functionalities, but they are also able to be used in other methods that are written to generically build upon those behaviors.</p>
</div></blockquote>
<section id="example-1-unitrange">
<h2>Example 1: <code class="docutils literal notranslate"><span class="pre">UnitRange</span></code><a class="headerlink" href="#example-1-unitrange" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">30</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1:30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UnitRange{Int64}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">supertypes</span><span class="p">(</span><span class="kt">UnitRange</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(UnitRange, AbstractUnitRange{T} where T&lt;:Real, OrdinalRange{T, T} where T&lt;:Real, AbstractRange{T} where T&lt;:Real, AbstractVector{T} where T&lt;:Real, Any)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractArray</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
<p>Because it is a subtype of <code class="docutils literal notranslate"><span class="pre">AbstractArray</span></code> we can do array-like things with it (it should basically behave like an array!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(30,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">eltype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64
</pre></div>
</div>
</div>
</div>
<p>However, it’s not implemented like a regular <code class="docutils literal notranslate"><span class="pre">Array</span></code> at all.</p>
<p>In fact, it’s just two numbers! We can see this by looking at it’s fields:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fieldnames</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(:start, :stop)
</pre></div>
</div>
</div>
</div>
<p>or just by inspecting the source code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@which</span><span class="w"> </span><span class="kt">UnitRange</span><span class="p">{</span><span class="kt">Int64</span><span class="p">}(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">UnitRange{T}(start::<b>T</b>, stop::<b>T</b>)<i> where T<:Real</i> in Base at <a href="https://github.com/JuliaLang/julia/tree/00177ebc4fcadaaa37c4c2cbca2f9db75ba4d8e3/base/range.jl#L393" target="_blank">range.jl:393</a></div></div>
</div>
<p>It is an <code class="docutils literal notranslate"><span class="pre">immutable</span></code> type which just holds the start and stop values.</p>
<p>This means that indexing, <code class="docutils literal notranslate"><span class="pre">A[i]</span></code>, is not just a look-up but a (small) function (try <code class="docutils literal notranslate"><span class="pre">&#64;which</span> <span class="pre">getindex(x,</span> <span class="pre">4)</span></code>).</p>
<p>What’s nice about this is that we can use it in calculations and no array, containing the numbers from 1 to 30, is ever created.</p>
<p>Allocating memory is typically costly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@time</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.054209 seconds (2 allocations: 76.294 MiB, 28.63% gc time)
</pre></div>
</div>
</div>
</div>
<p>But creating an immutable type of two numbers is essentially free, no matter what those two numbers are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@time</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.000000 seconds
</pre></div>
</div>
</div>
</div>
<p>This is so far the same as in Python, but here is a key difference:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">*</span><span class="p">:</span> <span class="s1">&#39;range&#39;</span> <span class="ow">and</span> <span class="s1">&#39;int&#39;</span>
</pre></div>
</div>
<p>As Julia uses multiple dispatch, <code class="docutils literal notranslate"><span class="pre">UnitRange</span></code> has its own methods defined for arithmetic which are <strong>custom made for that type</strong>. Not only does it behave the same way as an array with the same operations, it also does so <strong>with great performance</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Double all elements in the range and print off the 10th element:</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="n">println</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.096616 seconds (4 allocations: 152.588 MiB, 36.33% gc time)
  0.000001 seconds
20
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Sum all of the elements in the range:</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">))</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.138812 seconds (2 allocations: 76.294 MiB, 67.88% gc time)
  0.000000 seconds
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50000005000000
</pre></div>
</div>
</div>
</div>
<p>Parts of this do work in Python:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="o">%</span><span class="k">time</span> sum(range(10_000_000))
<span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">183</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">169</span> <span class="n">µs</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">183</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">183</span> <span class="n">ms</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span><span class="w">  </span><span class="c"># This will be explained later</span>
<span class="k">using</span><span class="w"> </span><span class="n">PythonCall</span><span class="w">  </span><span class="c"># As well as this</span>

<span class="nd">@btime</span><span class="w"> </span><span class="nd">@pyexec</span><span class="w"> </span><span class="s">&quot;sum(range(10_000_000))&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  192.622 ms (0 allocations: 0 bytes)
</pre></div>
</div>
</div>
</div>
<p>This effectively does the same thing the <code class="docutils literal notranslate"><span class="pre">collect</span></code> example does, just a few times slower, and far slower than the example using a range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@which</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000_000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">sum(r::<b>AbstractRange{<:Real}</b>) in Base at <a href="https://github.com/JuliaLang/julia/tree/00177ebc4fcadaaa37c4c2cbca2f9db75ba4d8e3/base/range.jl#L1387" target="_blank">range.jl:1387</a></div></div>
</div>
<p>Duck typing and interfaces let us define specialised code that is very performant, and interacts with the rest of the language as expected.</p>
</section>
<section id="example-2-diagonalmatrix">
<h2>Example 2: <code class="docutils literal notranslate"><span class="pre">DiagonalMatrix</span></code><a class="headerlink" href="#example-2-diagonalmatrix" title="Permalink to this headline">#</a></h2>
<p>Let’s create a simple custom <code class="docutils literal notranslate"><span class="pre">DiagonalMatrix</span></code> type that can represent square diagonal matrices, i.e.</p>
<div class="math notranslate nohighlight">
\[\begin{split} D = \left( \begin{matrix} x &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; y &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; z &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; \ddots \end{matrix} \right) \end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">DiagonalMatrix</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractArray</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>
<span class="w">    </span><span class="n">diag</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>In the spirit of duck typing, we integrate our <code class="docutils literal notranslate"><span class="pre">DiagonalMatrix</span></code> into Julia’s type hierarchy by making it a subtype (<code class="docutils literal notranslate"><span class="pre">&lt;:</span></code>) of <code class="docutils literal notranslate"><span class="pre">AbstractMatrix</span></code> to indicate <strong>array-like behavior</strong>. (Note that this does not indicate inheritence of structure!)</p>
<p>Of course, to actually make it behave like a matrix (a two-dimensional array) we must also implement (parts of) the <a class="reference external" href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interface-array-1"><code class="docutils literal notranslate"><span class="pre">AbstractArray</span></code> interface</a>.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">DiagonalMatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">MethodError</span>: no method matching size(::DiagonalMatrix{Int64})
<span class="n">Closest</span> <span class="n">candidates</span> <span class="n">are</span><span class="p">:</span>
  <span class="n">size</span><span class="p">(::</span><span class="n">AbstractArray</span><span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">},</span> <span class="p">::</span><span class="n">Any</span><span class="p">)</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">}</span> <span class="n">at</span> <span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">42</span>
  <span class="n">size</span><span class="p">(::</span><span class="n">Union</span><span class="p">{</span><span class="n">LinearAlgebra</span><span class="o">.</span><span class="n">Adjoint</span><span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="p">},</span> <span class="n">LinearAlgebra</span><span class="o">.</span><span class="n">Transpose</span><span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="p">}}</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="o">&lt;</span><span class="p">:(</span><span class="n">AbstractVector</span><span class="p">)})</span> <span class="n">at</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">LinearAlgebra</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">adjtrans</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">173</span>
  <span class="n">size</span><span class="p">(::</span><span class="n">Union</span><span class="p">{</span><span class="n">LinearAlgebra</span><span class="o">.</span><span class="n">Adjoint</span><span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="p">},</span> <span class="n">LinearAlgebra</span><span class="o">.</span><span class="n">Transpose</span><span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="p">}}</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="s2">&quot;#s886&quot;</span><span class="o">&lt;</span><span class="p">:(</span><span class="n">AbstractMatrix</span><span class="p">)})</span> <span class="n">at</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">LinearAlgebra</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">adjtrans</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">174</span>
  <span class="o">...</span>

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">length</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">279</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">isempty</span><span class="p">(</span><span class="n">a</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1170</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">show</span><span class="p">(</span><span class="n">io</span><span class="p">::</span><span class="n">IOContext</span><span class="p">{</span><span class="n">IOBuffer</span><span class="p">},</span> <span class="c1">#unused#::MIME{Symbol(&quot;text/plain&quot;)}, X::DiagonalMatrix{Int64})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">364</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">limitstringmime</span><span class="p">(</span><span class="n">mime</span><span class="p">::</span><span class="n">MIME</span><span class="p">{</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)},</span> <span class="n">x</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">inline</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">43</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">display_mimestring</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">MIME</span><span class="p">{</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)},</span> <span class="n">x</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">display</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">71</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">display_dict</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">display</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">102</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="c1">#invokelatest#2</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">729</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">invokelatest</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">726</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="n">execute_request</span><span class="p">(</span><span class="n">socket</span><span class="p">::</span><span class="n">ZMQ</span><span class="o">.</span><span class="n">Socket</span><span class="p">,</span> <span class="n">msg</span><span class="p">::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">Msg</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">execute_request</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">112</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="c1">#invokelatest#2</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">729</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">invokelatest</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">726</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">eventloop</span><span class="p">(</span><span class="n">socket</span><span class="p">::</span><span class="n">ZMQ</span><span class="o">.</span><span class="n">Socket</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">eventloop</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">8</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="p">(::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#15#18&quot;</span><span class="p">)()</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">./</span><span class="n">task</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">484</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">DiagonalMatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">CanonicalIndexError</span>: getindex not defined for DiagonalMatrix{Int64}

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">error_if_canonical_getindex</span><span class="p">(::</span><span class="n">IndexCartesian</span><span class="p">,</span> <span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="p">::</span><span class="n">Int64</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1260</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">getindex</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1240</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">isassigned</span><span class="p">(::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="p">::</span><span class="n">Int64</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">565</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">alignment</span><span class="p">(</span><span class="n">io</span><span class="p">::</span><span class="n">IOContext</span><span class="p">{</span><span class="n">IOBuffer</span><span class="p">},</span> <span class="n">X</span><span class="p">::</span><span class="n">AbstractVecOrMat</span><span class="p">,</span> <span class="n">rows</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">cols</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">cols_if_complete</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">cols_otherwise</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">sep</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">ncols</span><span class="p">::</span><span class="n">Int64</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">68</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">_print_matrix</span><span class="p">(</span><span class="n">io</span><span class="p">::</span><span class="n">IOContext</span><span class="p">{</span><span class="n">IOBuffer</span><span class="p">},</span> <span class="n">X</span><span class="p">::</span><span class="n">AbstractVecOrMat</span><span class="p">,</span> <span class="n">pre</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">sep</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">post</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">hdots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">vdots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">ddots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">hmod</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">vmod</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">rowsA</span><span class="p">::</span><span class="n">UnitRange</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">colsA</span><span class="p">::</span><span class="n">UnitRange</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">207</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">print_matrix</span><span class="p">(</span><span class="n">io</span><span class="p">::</span><span class="n">IOContext</span><span class="p">{</span><span class="n">IOBuffer</span><span class="p">},</span> <span class="n">X</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">pre</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">sep</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">post</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">hdots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">vdots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">ddots</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">hmod</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">vmod</span><span class="p">::</span><span class="n">Int64</span><span class="p">)</span> <span class="p">(</span><span class="n">repeats</span> <span class="mi">2</span> <span class="n">times</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">171</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="n">print_array</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">358</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">show</span><span class="p">(</span><span class="n">io</span><span class="p">::</span><span class="n">IOContext</span><span class="p">{</span><span class="n">IOBuffer</span><span class="p">},</span> <span class="c1">#unused#::MIME{Symbol(&quot;text/plain&quot;)}, X::DiagonalMatrix{Int64})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">arrayshow</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">399</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="n">limitstringmime</span><span class="p">(</span><span class="n">mime</span><span class="p">::</span><span class="n">MIME</span><span class="p">{</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)},</span> <span class="n">x</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">inline</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">43</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">display_mimestring</span>
    <span class="o">@</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">display</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">71</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">display_dict</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">display</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">102</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="c1">#invokelatest#2</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">729</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="n">invokelatest</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">726</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="n">execute_request</span><span class="p">(</span><span class="n">socket</span><span class="p">::</span><span class="n">ZMQ</span><span class="o">.</span><span class="n">Socket</span><span class="p">,</span> <span class="n">msg</span><span class="p">::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">Msg</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">execute_request</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">112</span>
 <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="c1">#invokelatest#2</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">729</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="n">invokelatest</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">essentials</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">726</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="n">eventloop</span><span class="p">(</span><span class="n">socket</span><span class="p">::</span><span class="n">ZMQ</span><span class="o">.</span><span class="n">Socket</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">IJulia</span><span class="o">/</span><span class="mi">6</span><span class="n">TIq1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">eventloop</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">8</span>
 <span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="p">(::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#15#18&quot;</span><span class="p">)()</span>
    <span class="o">@</span> <span class="n">IJulia</span> <span class="o">./</span><span class="n">task</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">484</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">Base</span><span class="o">.</span><span class="n">getindex</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">eltype</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 DiagonalMatrix{Int64}:
 1  0  0
 0  2  0
 0  0  3
</pre></div>
</div>
</div>
</div>
<p>Note how it’s automagically pretty printed (despite the fact that we never defined any special printing)!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">CanonicalIndexError</span>: setindex! not defined for DiagonalMatrix{Int64}

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">error_if_canonical_setindex</span><span class="p">(::</span><span class="n">IndexCartesian</span><span class="p">,</span> <span class="p">::</span><span class="n">DiagonalMatrix</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="p">::</span><span class="n">Int64</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1354</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">setindex</span><span class="o">!(</span>::DiagonalMatrix<span class="o">{</span>Int64<span class="o">}</span>,<span class="w"> </span>::Int64,<span class="w"> </span>::Int64,<span class="w"> </span>::Int64<span class="o">)</span>
   <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1343</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">Base</span><span class="o">.</span><span class="n">setindex!</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span>
<span class="w">        </span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&quot;cannot set off-diagonal entry (</span><span class="si">$i</span><span class="s">, </span><span class="si">$j</span><span class="s">)&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 DiagonalMatrix{Int64}:
 1  0  0
 0  2  0
 0  0  5
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">ArgumentError</span>: cannot set off-diagonal entry (3, 4)

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">setindex</span><span class="o">!(</span>D::DiagonalMatrix<span class="o">{</span>Int64<span class="o">}</span>,<span class="w"> </span>v::Int64,<span class="w"> </span>i::Int64,<span class="w"> </span>j::Int64<span class="o">)</span>
   <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span><span class="mi">5</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>But that’s not it. Because of duck typing, all kinds of different functions now “just work”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">eltype</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="c"># element data type</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="c"># addition</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 Matrix{Int64}:
 2  0   0
 0  4   0
 0  0  10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="c"># multiplication</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 Matrix{Int64}:
 1  0   0
 0  4   0
 0  0  25
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="c"># inversion</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 Matrix{Float64}:
 1.0  0.0  0.0
 0.0  0.5  0.0
 0.0  0.0  0.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="c"># broadcasting</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3×3 Matrix{Float64}:
 0.841471  0.0        0.0
 0.0       0.909297   0.0
 0.0       0.0       -0.958924
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="n">eigen</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="c"># eigensolver</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Eigen{Float64, Float64, Matrix{Float64}, Vector{Float64}}
values:
3-element Vector{Float64}:
 1.0
 2.0
 5.0
vectors:
3×3 Matrix{Float64}:
 1.0  0.0  0.0
 0.0  1.0  0.0
 0.0  0.0  1.0
</pre></div>
</div>
</div>
</div>
<p>Of course, so far, these operations have suboptimal performance because they don’t utilize the special structure inherent to our <code class="docutils literal notranslate"><span class="pre">DiagonalMatrix</span></code> but fall back to generic implementations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@which</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">+(A::<b>AbstractArray</b>, B::<b>AbstractArray</b>) in Base at <a href="https://github.com/JuliaLang/julia/tree/00177ebc4fcadaaa37c4c2cbca2f9db75ba4d8e3/base/arraymath.jl#L6" target="_blank">arraymath.jl:6</a></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.:+</span><span class="p">(</span><span class="n">Da</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">Da</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Db</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@which</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">+(Da::<b>DiagonalMatrix</b>, Db::<b>DiagonalMatrix</b>) in Main at In[37]:1</div></div>
</div>
<p>Important note: <strong>user defined types are just as good as built-in types!</strong></p>
<p>There is nothing special about built-in types. In fact, <a class="reference external" href="https://github.com/JuliaLang/julia/blob/master/stdlib/LinearAlgebra/src/diagonal.jl#L5">they are implemented in essentially the same way</a>!</p>
<p>Whereas diagonal arrays in something like Numpy are <a class="reference external" href="https://github.com/numpy/numpy/blob/d4b2d4f80060285ac085ea874aceaf9fa1bfb757/numpy/core/src/multiarray/item_selection.c#L1964">some C code</a></p>
</section>
<section id="side-note-consistency-of-interfaces">
<h2>Side Note: Consistency of Interfaces<a class="headerlink" href="#side-note-consistency-of-interfaces" title="Permalink to this headline">#</a></h2>
<p>Another benefit of the abstract type/interface/multiple dispatch style is that interfaces are very consistent within Julia, across not just the base language but across packages as well.</p>
<p>An article called <a class="reference external" href="https://towardsdatascience.com/python-vs-julia-its-also-about-consistency-236812dd64ba">Python vs. Julia: It’s also about Consistency</a> shows this point quite well.</p>
</section>
<section id="benchmarking-with-benchmarktools-jl">
<h2>Benchmarking with <a class="reference external" href="https://github.com/JuliaCI/BenchmarkTools.jl"><code class="docutils literal notranslate"><span class="pre">BenchmarkTools.jl</span></code></a><a class="headerlink" href="#benchmarking-with-benchmarktools-jl" title="Permalink to this headline">#</a></h2>
<p>Benchmarking is difficult to do right for many reasons</p>
<ul class="simple">
<li><p>computers are noisy machines</p></li>
<li><p>global vs local scope</p></li>
<li><p>the first function call is special in Julia (more later)</p></li>
<li><p>…</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>g (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.059905 seconds (218.68 k allocations: 11.185 MiB, 99.52% compilation time)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2×2 Matrix{Float64}:
 2.17578  0.275548
 2.57232  0.509042
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@time</span><span class="w"> </span><span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>f (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.000001 seconds (1 allocation: 96 bytes)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2×2 Matrix{Float64}:
 2.84491  1.27985
 2.89121  1.09645
</pre></div>
</div>
</div>
</div>
<p>Fortunately, there are tools that do this for us. In addition, they also collect some statistics by running the benchmark multiple times.</p>
<p>General rule: <strong>Don’t use <code class="docutils literal notranslate"><span class="pre">&#64;time</span></code> but <code class="docutils literal notranslate"><span class="pre">&#64;btime</span></code></strong> from <a class="reference external" href="https://github.com/JuliaCI/BenchmarkTools.jl">BenchmarkTools.jl</a> and <strong>interpolate (<code class="docutils literal notranslate"><span class="pre">$</span></code>) input arguments</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@btime</span><span class="w"> </span><span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  44.073 ns (1 allocation: 96 bytes)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2×2 Matrix{Float64}:
 2.17578  0.275548
 2.57232  0.509042
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@benchmark</span><span class="w"> </span><span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BenchmarkTools.Trial: 10000 samples with 990 evaluations.
 Range (<span class=" -Color -Color-Bold -Color-Bold-Cyan">min</span> … <span class=" -Color -Color-Magenta">max</span>):  <span class=" -Color -Color-Bold -Color-Bold-Cyan">44.502 ns</span> … <span class=" -Color -Color-Magenta"> 1.551 μs</span>  ┊ GC (min … max): 0.00% … 96.36%
 Time  (<span class=" -Color -Color-Bold -Color-Bold-Blue">median</span>):     <span class=" -Color -Color-Bold -Color-Bold-Blue">46.556 ns              </span>┊ GC (median):    0.00%
 Time  (<span class=" -Color -Color-Bold -Color-Bold-Green">mean</span> ± <span class=" -Color -Color-Green">σ</span>):   <span class=" -Color -Color-Bold -Color-Bold-Green">51.344 ns</span> ± <span class=" -Color -Color-Green">54.011 ns</span>  ┊ GC (mean ± σ):  4.63% ±  4.29%

  ▃▇█<span class=" -Color -Color-Blue">▇</span>▄▂▂▂<span class=" -Color -Color-Green">▂</span>▂▁▂▁▁▁                                   ▁▂▁       ▂
  ███<span class=" -Color -Color-Blue">█</span>████<span class=" -Color -Color-Green">█</span>████████▆▄▄▄▃▃▁▁▁▃▁▁▁▁▁▁▁▁▁▃▁▁▁▁▁▁▁▁▁▁▁▅█████▇▆▇██ █
  44.5 ns      Histogram: <span class=" -Color -Color-Bold">log(</span>frequency<span class=" -Color -Color-Bold">)</span> by time        92 ns <span class=" -Color -Color-Bold">&lt;</span>

 Memory estimate: <span class=" -Color -Color-Yellow">96 bytes</span>, allocs estimate: <span class=" -Color -Color-Yellow">1</span>.
</pre></div>
</div>
</div>
</div>
<section id="custom-types-are-just-as-good-as-built-in-types">
<h3>Custom types are just as good as built-in types<a class="headerlink" href="#custom-types-are-just-as-good-as-built-in-types" title="Permalink to this headline">#</a></h3>
<p>Let’s compare our custom <code class="docutils literal notranslate"><span class="pre">DiagonalMatrix</span></code> against the standard <code class="docutils literal notranslate"><span class="pre">Diagonal</span></code> type that ships in the <code class="docutils literal notranslate"><span class="pre">LinearAlgebra</span></code> standard library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="n">Djl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Diagonal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">Djl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">Djl</span><span class="p">;</span>
<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">D</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  91.078 ns (1 allocation: 896 bytes)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  90.776 ns (1 allocation: 896 bytes)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="example-3-cooler-diagonal-matrix">
<h2>Example 3: Cooler Diagonal Matrix<a class="headerlink" href="#example-3-cooler-diagonal-matrix" title="Permalink to this headline">#</a></h2>
<p>What we made works quite well, but could be even neater if we remove the <code class="docutils literal notranslate"><span class="pre">Vector</span></code> restriction, and instead just use <code class="docutils literal notranslate"><span class="pre">AbstractVector</span></code>s. That way it could even work with ranges!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">CoolerDiagonalMatrix</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractArray</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span>
<span class="w">    </span><span class="n">diag</span><span class="o">::</span><span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">Base</span><span class="o">.</span><span class="n">getindex</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">CoolerDiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">eltype</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="n">Base</span><span class="o">.:+</span><span class="p">(</span><span class="n">Da</span><span class="o">::</span><span class="kt">CoolerDiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="o">::</span><span class="kt">CoolerDiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoolerDiagonalMatrix</span><span class="p">(</span><span class="n">Da</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Db</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Old version:</span>
<span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000</span><span class="p">))</span>
<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">D</span>

<span class="c"># New:</span>
<span class="n">D_cool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoolerDiagonalMatrix</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10_000</span><span class="p">)</span>
<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">D_cool</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">D_cool</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5.581 μs (2 allocations: 78.17 KiB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  122.269 ns (3 allocations: 112 bytes)
</pre></div>
</div>
</div>
</div>
<p>Works! But… why are the allocations up? Let’s explore more:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">100</span><span class="p">))</span>
<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">D</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">D</span>

<span class="n">D_cool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoolerDiagonalMatrix</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">100</span><span class="p">))</span>
<span class="nd">@btime</span><span class="w"> </span><span class="o">$</span><span class="n">D_cool</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">$</span><span class="n">D_cool</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  86.342 ns (1 allocation: 896 bytes)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  193.898 ns (2 allocations: 912 bytes)
</pre></div>
</div>
</div>
</div>
<p>Huh… the new type is slower even with the same arguments? Why?</p>
<p>We’ll explore this in the sessions tomorrow.</p>
<p>p.s. Numpy:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span>In [1]: import numpy as np

In [2]: d = np.diag(np.arange(1000))

In [3]: %timeit d + d
2.56 µs ± 35.5 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)
</pre></div>
</div>
<p>Is still slower than any of the Julia code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">PythonCall</span>

<span class="nd">@btime</span><span class="w"> </span><span class="nd">@pyexec</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">import numpy as np</span>

<span class="s">d = np.diag(np.arange(1_000))</span>

<span class="s">d + d</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1.110 ms (0 allocations: 0 bytes)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="core-messages-of-this-notebook">
<h1>Core messages of this notebook<a class="headerlink" href="#core-messages-of-this-notebook" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Duck typing is about <strong>shared behavior</strong> instead of shared structure.</p></li>
<li><p><strong>User defined types are as good as built-in types.</strong></p></li>
<li><p>We can <strong>extend Base functions</strong> for our types to implement arithmetics and such.</p></li>
<li><p><strong>Subtyping an existing interface</strong> can give lots of functionality for free.</p></li>
<li><p>Functions should almost always be benchmarked with <strong>BenchmarkTools.jl’s <code class="docutils literal notranslate"><span class="pre">&#64;btime</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;benchmark</span></code></strong> instead of <code class="docutils literal notranslate"><span class="pre">&#64;time</span></code>.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/carstenbauer/JuliaHLRS22/blob/main/Day1/2_duck_typing_and_benchmarking.ipynb">https://github.com/carstenbauer/JuliaHLRS22/blob/main/Day1/2_duck_typing_and_benchmarking.ipynb</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/python-vs-julia-its-also-about-consistency-236812dd64ba">https://towardsdatascience.com/python-vs-julia-its-also-about-consistency-236812dd64ba</a></p></li>
<li><p><a class="reference external" href="https://docs.julialang.org/en/v1/manual/performance-tips/#Avoid-untyped-global-variables">https://docs.julialang.org/en/v1/manual/performance-tips/#Avoid-untyped-global-variables</a></p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.8"
        },
        kernelOptions: {
            kernelName: "julia-1.8",
            path: "./sessions/1-basics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.8'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="1-types-dispatch.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="3-specialization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Code Specialization</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Robert Rosca<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>